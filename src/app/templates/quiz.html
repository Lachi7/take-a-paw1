{% extends "base.html" %} 
{% block title %}Quiz â€” Take A Paw{% endblock %} 
{% block content %}
<style>
  .quiz-container {
    max-width: 800px;
    margin: 0 auto;
  }
  #result ul {
    list-style-type: none;
    padding-left: 0;
  }

  #result ul li {
    background-color: #f9f9f9;
    border-radius: 8px;
    margin: 10px 0;
    padding: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  #result ul li strong {
    font-size: 1.2rem;
    color: var(--accent);
  }

  #result ul li span {
    font-size: 0.9rem;
    color: #666;
  }

  .quiz-form {
    padding: 2rem;
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  select,
  button {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--border);
    border-radius: 8px;
    background-color: #fff;
    font-size: 1rem;
  }

  button {
    background-color: var(--accent);
    color: white;
    border: none;
    cursor: pointer;
  }

  button:hover {
    background-color: #3c2614;
  }

  h1 {
    margin-bottom: 1rem;
  }

  h3 {
    margin-top: 1.5rem;
  }

  #result {
    margin-top: 1.5rem;
  }

  .form-group label {
    font-weight: 600;
  }
  select option:disabled {
    color: #888;
    font-style: italic;
  }
</style>

<div class="quiz-container">
  <h1>Find Your Perfect Pet</h1>
  <p>Answer a few questions to help us recommend the best pet for you!</p>

  <form id="quizForm" class="quiz-form mt-4">
    <div class="form-group">
      <label for="homeType">Home type best suited</label>
      <select id="homeType">
        <option value="">No preference</option>
        <option value="apartment">Apartment</option>
        <option value="house_with_yard">House with yard</option>
        <option value="farm">Farm / rural</option>
      </select>
    </div>

    <div class="form-group">
      <label for="activityLevel">Pet activity level</label>
      <select id="activityLevel">
        <option value="">No preference</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>
    </div>

    <div class="form-group">
      <label for="experience">Experience level required</label>
      <select id="experience">
        <option value="">No preference</option>
        <option value="beginner">Beginner-friendly</option>
        <option value="intermediate">Some experience</option>
        <option value="advanced">Experienced only</option>
      </select>
    </div>

    <div class="form-group">
      <label for="timeCommitment">Time commitment needed</label>
      <select id="timeCommitment">
        <option value="">No preference</option>
        <option value="low">Low</option>
        <option value="medium">Moderate</option>
        <option value="high">High</option>
      </select>
    </div>

    <div class="form-group">
      <label for="familySituation">Best family situation</label>
      <select id="familySituation">
        <option value="">No preference</option>
        <option value="no_children">No children</option>
        <option value="older_children">Older children</option>
        <option value="small_children">Small children</option>
        <option value="other_pets_ok">Good with other pets</option>
      </select>
    </div>

    <button type="submit">Submit</button>
  </form>

  <div id="result" class="mt-4"></div>
</div>

<script>
  $(document).ready(function () {
    $("#quizForm").on("submit", function (e) {
      e.preventDefault();

      const data = {
        home_type: $("#homeType").val(),
        activity_level: $("#activityLevel").val(),
        experience: $("#experience").val(),
        time_commitment: $("#timeCommitment").val(),
        family_situation: $("#familySituation").val(),
      };

      $.ajax({
        url: "/quiz/results",
        method: "POST",
        contentType: "application/json",
        data: JSON.stringify(data),
        success: function (response) {
          console.log(data);
          if (response.ok) {
            const pets = response.matches;
            let html = "<h3>Recommended Pets</h3><ul>";
            pets.forEach(function (pet) {
              html += `
                <li>
                  <strong>${pet.name}</strong> (${pet.species}, ${pet.breed})<br>
                  Location: ${pet.location}<br>
                  <button 
                    type="button" 
                    class="btn outline view-details-btn" 
                    data-pet-id="${pet.id}">
                    View Details
                  </button>
                  <div 
                    class="pet-details" 
                    id="pet-details-${pet.id}" 
                    style="display:none; margin-top:0.5rem;">
                  </div>
                </li>
              `;
            });
            html += "</ul>";
            $("#result").html(html);
          } else {
            $("#result").html("<p>No matching pets found.</p>");
          }

        },
        error: function () {
          $("#result").html(
            "<p>There was an error. Please try again later.</p>"
          );
        },
      });
    });
  });
</script>
{% endblock %}
